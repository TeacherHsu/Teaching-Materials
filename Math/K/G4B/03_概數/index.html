<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>概數魔法｜無限練習版</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
.slot{
display:inline-flex;
min-width:64px;height:52px;
border:3px dashed #cbd5e1;border-radius:10px;
align-items:center;justify-content:center;
font-size:24px;font-weight:bold;
cursor:pointer;background:#f8fafc;
margin:4px;
}
.slot.filled{border-style:solid;border-color:#2563eb;background:#eff6ff;}
.toast{
position:fixed;bottom:30px;left:50%;
transform:translateX(-50%);
background:#111827;color:white;
padding:12px 22px;border-radius:12px;
opacity:0;transition:.25s;
}
.toast.show{opacity:1;}
</style>
</head>

<body class="bg-slate-100 h-screen flex flex-col">

<header class="bg-white shadow p-4 flex justify-between">
<b class="text-blue-600 text-xl">概數魔法｜無限挑戰</b>
<div>⭐ <span id="score">0</span></div>
</header>

<main class="flex-1 p-6">
<div id="question" class="text-2xl font-bold mb-6"></div>
<div id="workspace"></div>
<button id="next" class="mt-6 bg-green-600 text-white px-6 py-3 rounded-xl">下一題（重新生成）</button>
</main>

<div id="toast" class="toast"></div>

<script>
/* ===============================
   工具
================================*/
const rand=(min,max)=>Math.floor(Math.random()*(max-min+1))+min

function shuffle(arr){
for(let i=arr.length-1;i>0;i--){
const j=Math.floor(Math.random()*(i+1))
;[arr[i],arr[j]]=[arr[j],arr[i]]
}
return arr
}

/* ===============================
   題型生成器（真正無限題）
================================*/

function genRoundUpWithdrawal(){
const price=rand(2000,9800)
const need=Math.ceil(price/1000)*1000
return{
text:`商品價格 ${price} 元，提款機只能領千元，最少要領多少元？`,
answer:[need],
options:shuffle([
need,
need+1000,
need-1000<0?need:need-1000
])
}
}

function genBoxPacking(){
const total=rand(2000,9000)
const per=100
const box=Math.floor(total/per)
return{
text:`共有 ${total} 個物品，每 ${per} 個裝一盒，最多可裝幾盒？`,
answer:[box],
options:shuffle([box,box+1,box-1])
}
}

function genRoundToThousand(){
const num=rand(1000,9999)
const rounded=Math.round(num/1000)*1000
return{
text:`將 ${num} 用四捨五入取到千位是多少？`,
answer:[rounded],
options:shuffle([
rounded,
rounded+1000,
rounded-1000<0?rounded:rounded-1000
])
}
}

function genAdditionEstimate(){
const a=rand(20000,90000)
const b=rand(20000,90000)
const ra=Math.round(a/10000)*10000
const rb=Math.round(b/10000)*10000
return{
text:`${a} + ${b} 先取概數到萬位，再估算總和是多少？`,
answer:[ra+rb],
options:shuffle([ra+rb,ra+rb+10000,ra+rb-10000])
}
}

function genMultiplyEstimate(){
const price=rand(20000,50000)
const people=rand(3,7)
const rp=Math.round(price/1000)*1000
return{
text:`每人 ${price} 元，共 ${people} 人，先取千位概數後估算總價？`,
answer:[rp*people],
options:shuffle([
rp*people,
rp*(people+1),
rp*(people-1)
])
}
}

function genDivisionEstimate(){
const big=rand(4000,9000)
const small=rand(20,80)
const rb=Math.round(big/1000)*1000
const rs=Math.round(small/10)*10
const ans=Math.round(rb/rs)
return{
text:`${big} ÷ ${small} 先取最高位概數後估算約幾倍？`,
answer:[ans],
options:shuffle([ans,ans+5,ans-5])
}
}

const generators=[
genRoundUpWithdrawal,
genBoxPacking,
genRoundToThousand,
genAdditionEstimate,
genMultiplyEstimate,
genDivisionEstimate
]

/* ===============================
   狀態
================================*/
let current=null
let slots=[]
let score=0

function newQuestion(){
const g=generators[rand(0,generators.length-1)]
current=g()
slots=[null]
render()
}

/* ===============================
   UI
================================*/
function render(){
document.getElementById("question").innerText=current.text

const area=document.getElementById("workspace")
area.innerHTML=`
<div>
<span class="slot">${slots[0]??"?"}</span>
</div>
<div class="mt-4">
${current.options.map(o=>`<button class="opt border px-5 py-3 m-2">${o}</button>`).join("")}
</div>
<button id="check" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg">檢查答案</button>
`
}

/* ===============================
   事件代理
================================*/
document.addEventListener("click",e=>{

if(e.target.classList.contains("opt")){
slots[0]=Number(e.target.innerText)
render()
}

if(e.target.id==="check"){
check()
}

if(e.target.id==="next"){
newQuestion()
}

})

function check(){
if(slots[0]===null){
toast("請先作答")
return
}

if(slots[0]===current.answer[0]){
score+=10
document.getElementById("score").innerText=score
toast("答對！已產生新題")
setTimeout(newQuestion,600)
}else{
toast("再試一次")
}
}

function toast(msg){
const t=document.getElementById("toast")
t.innerText=msg
t.classList.add("show")
setTimeout(()=>t.classList.remove("show"),1500)
}

/* ===============================
   啟動
================================*/
newQuestion()
</script>
</body>
</html>
